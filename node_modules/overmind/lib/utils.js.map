{"version":3,"file":"utils.js","sourceRoot":"","sources":["../src/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import isPlainObject from 'is-plain-obj'\nimport { IMutation, IS_PROXY, VALUE } from 'proxy-state-tree'\n\nexport const IS_TEST = process.env.NODE_ENV === 'test'\nexport const IS_OPERATOR = Symbol('operator')\nexport const ORIGINAL_ACTIONS = Symbol('origina_actions')\nexport const EXECUTION = Symbol('execution')\n\nexport const MODE_DEFAULT = Symbol('MODE_DEFAULT')\nexport const MODE_TEST = Symbol('MODE_TEST')\nexport const MODE_SSR = Symbol('MODE_SSR')\n\nexport class MockedEventEmitter {\n  emit() {}\n  emitAsync() {}\n  on() {}\n  once() {}\n  addListener() {}\n}\n\nexport const json = <T>(obj: T): T => {\n  return deepCopy(obj && obj[IS_PROXY] ? obj[VALUE] : obj)\n}\n  \n\nexport function isPromise(maybePromise: any) {\n  return (\n    maybePromise instanceof Promise ||\n    (maybePromise &&\n      typeof maybePromise.then === 'function' &&\n      typeof maybePromise.catch === 'function')\n  )\n}\n\nexport function processState(state: {}) {\n  return Object.keys(state).reduce((aggr, key) => {\n    if (key === '__esModule') {\n      return aggr\n    }\n    const originalDescriptor = Object.getOwnPropertyDescriptor(state, key)\n\n    if (originalDescriptor && 'get' in originalDescriptor) {\n      Object.defineProperty(aggr, key, originalDescriptor as any)\n\n      return aggr\n    }\n\n    const value = state[key]\n\n    if (isPlainObject(value)) {\n      aggr[key] = processState(value)\n    } else {\n      Object.defineProperty(aggr, key, originalDescriptor as any)\n    }\n\n    return aggr\n  }, isPlainObject(state) ? {} : state)\n}\n\nexport function getFunctionName(func: Function) {\n  return func.name || (func as any).displayName || ''\n}\n\nexport function deepCopy(obj) {\n  if (isPlainObject(obj)) {\n    return Object.keys(obj).reduce((aggr: any, key) => {\n      if (key === '__esModule') {\n        return aggr\n      }\n\n      const originalDescriptor = Object.getOwnPropertyDescriptor(obj, key)\n      const isAGetter = originalDescriptor && 'get' in originalDescriptor\n      const value = obj[key]\n\n      if (isAGetter) {\n        Object.defineProperty(aggr, key, originalDescriptor as any)\n      } else {\n        aggr[key] = deepCopy(value)\n      }\n\n      return aggr\n    }, {})\n  } else if (Array.isArray(obj)) {\n    return obj.map((item) => deepCopy(item))\n  }\n\n  return obj\n}\n\nconst getChangeMutationsDelimiter = '.'\nexport function getChangeMutations(stateA: object, stateB: object, path: string[] = [], mutations: IMutation[] = []): IMutation[] {\n  const stateAKeys = Object.keys(stateA)\n  const stateBKeys = Object.keys(stateB)\n\n  stateAKeys.forEach((key) => {\n    if (!stateBKeys.includes(key)) {\n      mutations.push({\n        delimiter: getChangeMutationsDelimiter,\n        args: [],\n        path: path.concat(key).join('.'),\n        hasChangedValue: false,\n        method: 'unset',\n      })\n    }\n  })\n\n  stateBKeys.forEach((key) => {\n    if (isPlainObject(stateA[key]) && isPlainObject(stateB[key])) {\n      getChangeMutations(stateA[key], stateB[key], path.concat(key), mutations)\n    } else if (stateA[key] !== stateB[key]) {\n      mutations.push({\n        delimiter: getChangeMutationsDelimiter,\n        args: [stateB[key]],\n        path: path.concat(key).join('.'),\n        hasChangedValue: false,\n        method: 'set'\n      })\n    }\n  })\n\n  return mutations\n}\n\n\nexport function getActionPaths(actions = {}, currentPath: string[] = []) {\n  return Object.keys(actions).reduce<string[]>((aggr, key) => {\n    if (typeof actions[key] === 'function') {\n      return aggr.concat(currentPath.concat(key).join('.'))\n    }\n\n    return aggr.concat(getActionPaths(actions[key], currentPath.concat(key)))\n  }, [])\n}\n\nexport function createActionsProxy(actions, cb) {\n  return new Proxy(actions, {\n    get(target, prop) {\n      if (prop === ORIGINAL_ACTIONS) {\n        return actions\n      }\n\n      if (typeof target[prop] === 'function') {\n        return cb(target[prop])\n      }\n\n      if (!target[prop]) {\n        return undefined\n      }\n\n      return createActionsProxy(target[prop], cb)\n    },\n  })\n}\n"]}